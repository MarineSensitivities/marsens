<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Query WoRMS REST API with multiple requests — wm_rest • msens</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Query WoRMS REST API with multiple requests — wm_rest"><meta name="description" content="When trying to perform batch requests the WoRMS REST API unfortunately does
not return the requested field so it is not obvious which taxa requested
matches which response. Even when fetching records in batch by aphia_id
functions in the worrms R package do not page requests based on the record
limits of the WoRMS REST API. Finally, it is much preferred to use the
multiplexing capabilities of the latest httr2 library to send multiple
requests in parallel, versus each one sequentially."><meta property="og:description" content="When trying to perform batch requests the WoRMS REST API unfortunately does
not return the requested field so it is not obvious which taxa requested
matches which response. Even when fetching records in batch by aphia_id
functions in the worrms R package do not page requests based on the record
limits of the WoRMS REST API. Finally, it is much preferred to use the
multiplexing capabilities of the latest httr2 library to send multiple
requests in parallel, versus each one sequentially."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msens</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/msens.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MarineSensitivities/msens/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Query WoRMS REST API with multiple requests</h1>
      <small class="dont-index">Source: <a href="https://github.com/MarineSensitivities/msens/blob/main/R/worms.R" class="external-link"><code>R/worms.R</code></a></small>
      <div class="d-none name"><code>wm_rest.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When trying to perform batch requests the WoRMS REST API unfortunately does
not return the requested field so it is not obvious which taxa requested
matches which response. Even when fetching records in batch by <code>aphia_id</code>
functions in the <code>worrms</code> R package do not page requests based on the record
limits of the WoRMS REST API. Finally, it is much preferred to use the
multiplexing capabilities of the latest <code>httr2</code> library to send multiple
requests in parallel, versus each one sequentially.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">wm_rest</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">fld</span>,</span>
<span>  operation <span class="op">=</span> <span class="st">"AphiaRecordsByMatchNames"</span>,</span>
<span>  server <span class="op">=</span> <span class="st">"https://www.marinespecies.org/rest"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>data frame to match</p></dd>


<dt id="arg-fld">fld<a class="anchor" aria-label="anchor" href="#arg-fld"></a></dt>
<dd><p>field in data frame to use with operation</p></dd>


<dt id="arg-operation">operation<a class="anchor" aria-label="anchor" href="#arg-operation"></a></dt>
<dd><p>operation name of WoRMS REST API; One of operations listed
at <a href="https://www.marinespecies.org/rest" class="external-link">marinespecies.org/rest</a>, like
"AphiaRecordsByMatchNames" (non-paging), "AphiaRecordsByVernacular" (paging),
"AphiaRecordsByNames" (paging), or "AphiaRecordsByAphiaIDs" (paging);
default: "AphiaRecordsByMatchNames"</p></dd>


<dt id="arg-server">server<a class="anchor" aria-label="anchor" href="#arg-server"></a></dt>
<dd><p>URL of server REST endpoint; default: "https://www.marinespecies.org/rest"</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other query parameters to pass to operation</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data frame of results from WoRMS API prepended with unique values from <code>fld</code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">tmp_test</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>           <span class="op">~</span><span class="va">common</span>,                     <span class="op">~</span><span class="va">scientific</span>, <span class="va">aphia_id_0</span>,</span></span>
<span class="r-in"><span>     <span class="st">"Minke whale"</span>,     <span class="st">"Balaenoptera acutorostrata"</span>, <span class="fl">137087</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Blue whale"</span>,          <span class="st">"Balaenoptera musculus"</span>, <span class="fl">137090</span>,</span></span>
<span class="r-in"><span><span class="st">"Bonaparte's Gull"</span>,   <span class="st">"Chroicocephalus philadelphia"</span>, <span class="fl">882954</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 882954 invalid non-marine -&gt; valid marine 159076</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">wm_exact</span> <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByMatchNames"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wm_fuzzy</span> <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByNames"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wm_byid</span>  <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByNames"</span>, marine_only<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Best.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

